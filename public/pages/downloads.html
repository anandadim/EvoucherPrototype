<!-- Downloads Page -->
<div style="background: white; padding: 25px; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.08);">
  <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
    <h2 style="margin: 0; font-size: 20px; color: #333;">ðŸ“‹ Download Records</h2>
    <div style="display: flex; gap: 10px;">
      <button onclick="exportDownloadsPage()" style="padding: 10px 20px; background: #4caf50; color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 14px; font-weight: 600;">
        ðŸ“¥ Export CSV
      </button>
      <button onclick="refreshDownloadsPage()" style="padding: 10px 20px; background: #9e9e9e; color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 14px; font-weight: 600;">
        ðŸ”„ Refresh
      </button>
    </div>
  </div>
  
  <div style="overflow-x: auto;">
    <table style="width: 100%; border-collapse: collapse;">
      <thead>
        <tr style="background: #f5f5f5;">
          <th style="padding: 12px; text-align: left; border-bottom: 2px solid #e0e0e0;">No</th>
          <th style="padding: 12px; text-align: left; border-bottom: 2px solid #e0e0e0;">Nomor HP</th>
          <th style="padding: 12px; text-align: left; border-bottom: 2px solid #e0e0e0;">Voucher Number</th>
          <th style="padding: 12px; text-align: left; border-bottom: 2px solid #e0e0e0;">Source</th>
          <th style="padding: 12px; text-align: left; border-bottom: 2px solid #e0e0e0;">IP Address</th>
          <th style="padding: 12px; text-align: left; border-bottom: 2px solid #e0e0e0;">Waktu Download</th>
        </tr>
      </thead>
      <tbody id="downloadsTableBody">
        <tr>
          <td colspan="6" style="padding: 40px; text-align: center; color: #999;">Loading downloads...</td>
        </tr>
      </tbody>
    </table>
  </div>
</div>

<script>
async function loadDownloadsPage() {
  try {
    const response = await fetch('/api/admin/stats');
    const data = await response.json();
    
    const tbody = document.getElementById('downloadsTableBody');
    
    if (!data.downloads || data.downloads.length === 0) {
      tbody.innerHTML = '<tr><td colspan="6" style="padding: 40px; text-align: center; color: #999;">Belum ada data download</td></tr>';
      return;
    }

    tbody.innerHTML = data.downloads.map((row, index) => {
      const utmBadge = row.utm_source === 'direct' 
        ? '<span style="background: #9e9e9e; color: white; padding: 4px 8px; border-radius: 4px; font-size: 12px;">Direct</span>'
        : `<span style="background: #667eea; color: white; padding: 4px 8px; border-radius: 4px; font-size: 12px;">${row.utm_source || 'direct'}</span>`;
      
      return `
        <tr>
          <td style="padding: 12px; border-bottom: 1px solid #e0e0e0;">${index + 1}</td>
          <td style="padding: 12px; border-bottom: 1px solid #e0e0e0;">${row.phone_number}</td>
          <td style="padding: 12px; border-bottom: 1px solid #e0e0e0;"><span style="font-family: monospace; background: #f5f5f5; padding: 4px 8px; border-radius: 4px;">${row.voucher_number || 'N/A'}</span></td>
          <td style="padding: 12px; border-bottom: 1px solid #e0e0e0;">${utmBadge}</td>
          <td style="padding: 12px; border-bottom: 1px solid #e0e0e0;">${row.ip_address}</td>
          <td style="padding: 12px; border-bottom: 1px solid #e0e0e0;">${new Date(row.download_time).toLocaleString('id-ID')}</td>
        </tr>
      `;
    }).join('');
  } catch (error) {
    console.error('Error loading downloads:', error);
    document.getElementById('downloadsTableBody').innerHTML = 
      '<tr><td colspan="6" style="padding: 40px; text-align: center; color: #f44336;">Error loading data</td></tr>';
  }
}

function exportDownloadsPage() {
  window.location.href = '/api/admin/export-csv';
}

function refreshDownloadsPage() {
  loadDownloadsPage();
}

loadDownloadsPage();
</script>
